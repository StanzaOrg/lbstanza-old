defpackage stz/ids :
   import core
   import verse



val ID-COUNTER = to-stream(1000000 to false)
public defn fresh-id () : next(ID-COUNTER)


;                        Special Functions
;                        =================

public val EXTEND-HEAP-ID = fresh-id()
public val EXTEND-STACK-ID = fresh-id()
public val VARIABLE-UNINITIALIZED-ERROR-ID = fresh-id()

;                         Special Types
;                         =============

public val FN-TYPE-ID = fresh-id()
public val BOX-TYPE-ID = fresh-id()
public val TUPLE-TYPE-ID = fresh-id()
public val FALSE-TYPE-ID = fresh-id()
public val TRUE-TYPE-ID = fresh-id()

;                        Compiled Bit Tags
;                        =================

public val INT-TAG = 0
public val REF-TAG = 1
public val MARKER-TAG = 2
public val VOID-TAG = (-1 << 3) + MARKER-TAG

public val TAG-TAG = 0
public val HEADER-TAG = 1

;                       Compiled Stack Layout
;                       =====================

var STACK-ACCUM = 0
defn next-stack-offset (sz:Int) :
   val o = STACK-ACCUM
   STACK-ACCUM = STACK-ACCUM + sz
   o

next-stack-offset(8) ;Reserve Tag
public val STACK-INDEX-OFFSET = next-stack-offset(4)
public val STACK-MARK-OFFSET = next-stack-offset(4)
public val STACK-PARENT-OFFSET = next-stack-offset(8)
public val STACK-SP-OFFSET = next-stack-offset(8)
public val STACK-ITEMS-OFFSET = next-stack-offset(8)
public val STACK-SIZE = 512 * 8


;                     Compiled Program Labels
;                     =======================

;Heaps
public val HEAP-PTR-LBL = fresh-id()
public val HEAP-LIM-LBL = fresh-id()

;Stacks
public val STACKS-LBL = fresh-id()
public val STACK-LIM-LBL = fresh-id()
public val STACK-PTR-LBL = fresh-id()
public val STACK-LBL = fresh-id()
public val NUM-FREE-STACKS-LBL = fresh-id()

;Floating Point Default Values
public val FLOAT-ZERO-LBL = fresh-id()
public val DOUBLE-ZERO-LBL = fresh-id()

;Argument Buffer Label
public val ARG-LBL = fresh-id()

;Swap Label
public val SWAP-LBL = fresh-id()

;C Parameter Labels
public val C-RSP-LBL = fresh-id()
public val C-RBX-LBL = fresh-id()
public val C-RBP-LBL = fresh-id()
public val C-R12-LBL = fresh-id()
public val C-R13-LBL = fresh-id()
public val C-R14-LBL = fresh-id()
public val C-R15-LBL = fresh-id()

;Register Buffer Labels
public val R0_LBL = fresh-id()
public val R1_LBL = fresh-id()
public val R2_LBL = fresh-id()
public val R3_LBL = fresh-id()

