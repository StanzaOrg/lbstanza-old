defpackage stz/reg-alloc-errors :
  import core
  import collections
  import stz/printing-utils

public deftype RegAllocError <: Exception

;Occurs when there is an error when reading syntax for
;RegAllocIR.
public defstruct RegAllocSyntaxError <: RegAllocError :
  info:FileInfo|False
  msg
defmethod print (o:OutputStream, e:RegAllocSyntaxError) :
  print(o, "%_%_" % [info-str(info(e)), msg(e)])

;Helper: Create the information string.
defn info-str (info:FileInfo|False) :
  "" when info is False else "%_: " % [info]

;Report all errors within an OperationModel.
public defstruct OperationModelError <: RegAllocError :
  id:Int
  errors:Tuple<Exception>
defmethod print (o:OutputStream, e:OperationModelError) :
  print(o, "Invalid operation model op%_%_" % [
    id(e), colon-field-list(errors(e))])

public defn BadPreferenceForRequiredRegister () :
  RegAllocSyntaxError(false, "BadPreferenceForRequiredRegister")
public defn PreferSameNotAllowed () :
  RegAllocSyntaxError(false, "PreferSameNotAllowed")
public defn BadPreferSame () :
  RegAllocSyntaxError(false, "BadPreferSame")
public defn PreferSameOfRequiredRegister () :
  RegAllocSyntaxError(false, "PreferSameOfRequiredRegister")
public defn PreferSameDifferentType () :
  RegAllocSyntaxError(false, "PreferSameDifferentType")
public defn DuplicateRequiredReg () :
  RegAllocSyntaxError(false, "DuplicateRequiredReg")
public defn ReleaseBadVar () :
  RegAllocSyntaxError(false, "ReleaseBadVar")
public defn AlreadyReleased () :
  RegAllocSyntaxError(false, "AlreadyReleased")
public defn BadReleaseAfterClearRegisters () :
  RegAllocSyntaxError(false, "BadReleaseAfterClearRegisters")
public defn AssignToBadVar () :
  RegAllocSyntaxError(false, "AssignToBadVar")
public defn AlreadyAssigned () :
  RegAllocSyntaxError(false, "AlreadyAssigned")
public defn BadAssignAfterClearRegisters () :
  RegAllocSyntaxError(false, "BadAssignAfterClearRegisters")
public defn ReturnNotLastStmt () :
  RegAllocSyntaxError(false, "ReturnNotLastStmt")
public defn ReturnWithResults () :
  RegAllocSyntaxError(false, "ReturnWithResults")
public defn ReturnWithClearRegisters () :
  RegAllocSyntaxError(false, "ReturnWithClearRegisters")
public defn RedundantClearRegisters () :
  RegAllocSyntaxError(false, "RedundantClearRegisters")
public defn UnassignedVar () :
  RegAllocSyntaxError(false, "UnassignedVar")
public defn UnreleasedVar () :
  RegAllocSyntaxError(false, "UnreleasedVar")
public defn AlreadyAssignedReg () :
  RegAllocSyntaxError(false, "AlreadyAssignedReg")
public defn BadlyFormedLocation () :
  RegAllocSyntaxError(false, "BadlyFormedLocation")