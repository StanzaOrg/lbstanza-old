defpackage stz/il-ir :
   import core
   import verse

;============================================================
;================= Stanza Language ==========================
;============================================================

public definterface IExp
public defmulti info (e:IExp) -> FileInfo
public defmulti set-info (e:IExp, i:FileInfo) -> False

;======== Package Forms ========
   
public defstruct IPackage <: IExp :
   name: Symbol
   imports: List<IImport>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IImport <: IExp :
   package: Symbol
   prefix: List<IPrefix>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IPrefix <: IExp :
   names: False|List<Symbol>
   prefix: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IExport <: IExp :
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Declaration Forms ========

public defstruct IDefType <: IExp :
   class: Symbol
   args: List<IVar>
   parent: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IDef <: IExp :
   name: IExp
   type: IExp
   value: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IDefVar <: IExp :
   name: Symbol
   type: IExp
   value: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IDefn <: IExp :
   name: Symbol
   targs: List<IVar>
   func: IFn
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IDefmulti <: IExp :
   name: Symbol
   targs: List<IVar>
   a1: List<IExp>
   a2: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IDefmethod <: IExp :
   multi: IExp
   this-var: False|Symbol
   targs: List<IVar>
   func: IFn
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Expression Forms ========

public defstruct IFn <: IExp :
   tail?: True|False
   a1: List<IExp>
   a2: IExp
   args: List<IExp>
   body: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IMulti <: IExp :
   funcs: List<IFn>
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IBegin <: IExp :
   exps: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IMatch <: IExp :
   args: List<IExp>
   branches: List<IBranch>
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IBranch <: IExp :
   types: List<IExp>
   args: List<IExp>
   body: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct INew <: IExp :
   class: IExp
   methods: List<IDefmethod>
   info: FileInfo with :
      as-method => true
      setter => set-info  

public defstruct IVar <: IExp :
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ICast <: IExp :
   exp: IExp
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct ISet <: IExp :
   name: Symbol
   value: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IDo <: IExp :
   func: IExp
   targs: List<IExp>
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IPrim <: IExp :
   function: Symbol
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ICallLS <: IExp :
   function: Symbol
   targs: List<IExp>
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct ILiteral <: IExp :
   value
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ITuple <: IExp :
   exps: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info
   
;======== Type Forms ========

public defstruct IOf <: IExp :
   class: IExp
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IAnd <: IExp :
   a: IExp
   b: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IOr <: IExp :
   a: IExp
   b: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IArrow <: IExp :
   a1: List<IExp>
   a2: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ICap <: IExp :
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct IGradual <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info
   
public defstruct IVoid <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct INone <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

;============================================================
;================== LoStanza Language =======================
;============================================================

;======== Expression Forms ========

public defstruct ILSRef <: IExp :
   name: Symbol
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSRefArray <: IExp :
   name: Symbol
   length: List<IExp>
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSStruct <: IExp :
   name: Symbol
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSPtr <: IExp :
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSDeref <: IExp :
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSSlot <: IExp :
   exp: IExp
   index: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSField <: IExp :
   exp: IExp
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSDo <: IExp :
   func: IExp
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSCallC <: IExp :
   func: IExp
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSPrim <: IExp :
   op: Symbol
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSSizeof <: IExp :
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSTagof <: IExp :
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSAs <: IExp :
   exp: IExp
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSSignedCast <: IExp :
   exp: IExp
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSUnsignedCast <: IExp :
   exp: IExp
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSValue <: IExp :
   value
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSLetExp <: IExp :
   comm: IExp
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSAnd <: IExp :
   a: IExp
   b: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSOr <: IExp :
   a: IExp
   b: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Command Forms ========

public defstruct ILSTCall <: IExp :
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSSet <: IExp :
   exp: IExp
   value: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSLabel <: IExp :
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSGoto <: IExp :
   name: Symbol
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSReturn <: IExp :
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSLet <: IExp :
   body: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSIf <: IExp :
   pred: IExp
   conseq: IExp
   alt: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSBegin <: IExp :
   comms: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSMatch <: IExp :
   exp: IExp
   branches: List<ILSBranch>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSBranch <: IExp :
   types: List<IVar>
   body: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Declaration Forms ========

public defstruct ILSDef <: IExp :
   name: Symbol
   type: IExp
   exp: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSDefStruct <: IExp :
   name: Symbol
   parents: List<IVar>
   fields: List<KeyValue<IVar, IExp>>
   rest: False|KeyValue<IVar, IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSExtern <: IExp :
   name: Symbol
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSExternFn <: IExp :
   name: Symbol
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSDefn <: IExp :
   name: Symbol
   a1: List<IExp>
   a2: IExp
   args: List<IVar>
   body: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Type Forms ========
public defstruct ILSByteT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSIntT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSLongT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSFloatT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSDoubleT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSUnknownT <: IExp :
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSPtrT <: IExp :
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSRefT <: IExp :
   type: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

public defstruct ILSFnT <: IExp :
   a1: List<IExp>
   ar: False|IExp
   a2: IExp
   info: FileInfo with :
      as-method => true
      setter => set-info

;======== Intrinsics ========
public defstruct ILSIntrinsic <: IExp :
   name: Symbol
   targs: List<IExp>
   args: List<IExp>
   info: FileInfo with :
      as-method => true
      setter => set-info