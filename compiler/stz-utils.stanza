defpackage stz/utils :
   import core
   import verse

var FAILURE-CLOSURE: () -> Void = fn* () :
   error("Uncaught failure.")

public defn fail () :
   FAILURE-CLOSURE()
   
public defn attempt-clause<?T> (conseq: () -> ?T, alt: () -> ?T) :
   val result = label<Option<T>> return :
      FAILURE-CLOSURE = fn* () : return(None())
      Some(conseq())
   match(result) :
      (r:Some<T>) : item(r)
      (r:None) : alt()