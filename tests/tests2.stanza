defpackage user :
   import core
   import collections

defn blow-heap () :
   println("blow-heap")
   for i in 0 to 1000 do :
      Array<Int>(1000)

defn* main () :
   val trackers = to-list(seq(LivenessTracker, 0 to 100))
   val markers = map(new-marker, trackers)
   println(trackers)
   println(markers)

   defn* loop (markers:List<LivenessMarker>) :
      if not empty?(markers) :
         println("=========")
         println(head(markers))
         println(trackers)
         blow-heap()
         loop(tail(markers))
   loop(markers)

main()

;extern silly_add: (long, long) -> long
;
;defn IncException (x:Long) :
;   Exception("%_ is too large for inc." % [x])
;
;defn print-x (x:Long) :
;   println("silly_inc(%_)" % [x])
;   
;extern defn silly_inc (x:long) -> long :
;   if x > 10 : throw(IncException(new Long{x}))
;   print-x(new Long{x})
;   return x + 1
;
;lostanza defn silly_add (x:ref<Long>, y:ref<Long>) -> ref<Long> :
;   val r = call-c silly_add(x.value, y.value)
;   return new Long{r}
;   
;defn silly_times (x:Long, y:Long) :
;   println("silly_times(%_, %_)" % [x, y])
;   if y == 1L : x
;   else : silly_times(silly_add(x, y), y - 1L)
;
;defn try-times (x:Long) :
;   try :
;      println(silly_times(x, x))
;   catch (e:Exception) :
;      println(e)
;
;println("Perform 5x5")
;try-times(2L)
;try-times(3L)
;try-times(4L)
;try-times(5L)
;try-times(6L)