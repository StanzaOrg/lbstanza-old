defpackage test-sighandler :
  import core
  import polling-sighandler

defn main () :
  println("Start Program")
  
  val prev-handler = install-polling-sigint-handler()

  val num-interrupts = to-seq(0 to false)
  
  while true :

    if poll-sigint-flag() :
      println("SIGINT PRESSED: Occurrence %_" % [next(num-interrupts)])
      if peek(num-interrupts) == 10 :
        restore-previous-sigint-handler(prev-handler)
    else :
      println("...")
    
    try :
      sleep-ms(300L)
    catch (e:Exception) :
      println("sleep was interrupted: %_" % [e])
    
  println("Program Finished")

main()
    