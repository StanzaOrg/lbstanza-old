;Accurate model of X86 integer subtraction.
analyze subtraction :
  num-regs: 6
  num-fregs: 6
  model (V0:Rx) = op0(V1:Rx, V2:Rx) :
    release V1
    assign V0
    release V2
    
  ;Case: No argument is killed.
  ;Should use 1 register.
  UsageContext(killed = [])

  ;Case: First argument is killed.
  ;Should use 0 registers.
  UsageContext(killed = [0])

  ;Case: Second argument is killed.
  ;Should use 1 register.
  UsageContext(killed = [1])

;Accurate model of x86 integer addition.
analyze addition :
  num-regs: 16
  num-fregs: 16

  model (V0:Rx) = op0(V1:Rx, V2:Rx) :
    release V1
    release V2
    assign V0

  ;Case: No argument is killed.
  ;Requires 1 more register.
  UsageContext(killed = [])

  ;Case: First argument killed.
  ;Requires 0 registers.
  UsageContext(killed = [0])

  ;Case: Second argument killed.
  ;Requires 0 registers.
  UsageContext(killed = [1])

  ;Case: Both arguments killed.
  ;Requires 0 registers.
  UsageContext(killed = [0, 1])

;Model with clear-registers in the middle.
;The UsedRegisters should not include anything that occurs
;after clear-registers. Even though 7 registers is needed
;to store the result, the operation only requires 4 additional
;registers (to be used as temp) to be successful.
analyze test01 :
  num-regs: 16
  num-fregs: 16

  model (V0:Rx, V1:Rx, V2:Rx, V3:Rx, V4:Rx, V5:Rx, V6:Rx) = op0(V7:Rx, V8:Rx)
                                                            (temp V9:Rx V10:Rx V11:Rx V12:Rx) :
    assign V9
    assign V10
    assign V11
    assign V12
    release V7
    release V8
    clear-registers
    assign V0
    assign V1
    assign V2
    assign V3
    assign V4
    assign V5
    assign V6

  ;Should only require 4 registers
  UsageContext(killed = [])

;Like test01 except that result is assigned before clear-registers.
analyze test01b :
  num-regs: 16
  num-fregs: 16

  model (V0:Rx, V1:Rx, V2:Rx, V3:Rx, V4:Rx, V5:Rx, V6:Rx) = op0(V7:Rx, V8:Rx)
                                                            (temp V9:Rx V10:Rx V11:Rx V12:Rx) :
    assign V9
    assign V10
    assign V11
    assign V12
    release V7
    release V8
    assign V0
    clear-registers
    assign V1
    assign V2
    assign V3
    assign V4
    assign V5
    assign V6

  ;Should only require 4 registers
  UsageContext(killed = [])

;Different types of registers.
analyze test02 :
  num-regs: 16
  num-fregs: 16

  model (V0:Rx) = op0(V1:Rx, V2:Fx) :
    release V1
    release V2
    assign V0

  ;Nothing is killed, so needs one more register.
  UsageContext(killed = [])

  ;Integer register released, so no additional registers needed.
  UsageContext(killed = [0])

  ;Floating register released, so still needs one more register.
  UsageContext(killed = [1])

;Different types of registers.
analyze test03 :
  num-regs: 16
  num-fregs: 16

  model (V0:Rx, V1:Fx, V2:Fx) = op0(V3:Rx, V4:Fx) :
    release V3
    release V4
    assign V0
    assign V1
    assign V2

  ;Nothing is killed, so needs one more register.
  UsageContext(killed = [])

  ;Integer register released.
  UsageContext(killed = [0])

  ;Floating register released.
  UsageContext(killed = [1])

  ;Both integer and floating register released.
  UsageContext(killed = [0,1])

;Different specificities of registers.
;Result registers are more specific than argument registers.
analyze test04 :
  num-regs: 16
  num-fregs: 16

  model (V0:R3, V1:R4) = op0(V2:Rx, V3:Rx) :
    release V2
    release V3
    assign V0
    assign V1

  UsageContext(killed = [])
  UsageContext(killed = [0])
  UsageContext(killed = [1])
  UsageContext(killed = [0,1])

analyze test05 :
  num-regs: 16
  num-fregs: 16

  model (V0:R1) = op10(V1:Rx, V2:R2) :
    release V1
    release V2
    assign V0

  UsageContext(killed = [])

analyze test06 :
  num-regs: 16
  num-fregs: 16
  model (V0:Rx) = op11(V1:Rx, V2:Rx, V3:Rx) (temp V4:Rx, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0
    
analyze test06a :
  num-regs: 16
  num-fregs: 16
  model (V0:Rx) = op11(V1:R1, V2:R1, V3:Rx) (temp V4:Rx, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0

analyze test06b :
  num-regs: 16
  num-fregs: 16
  model (V0:Rx) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:R1, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0
    
analyze test06c :
  num-regs: 16
  num-fregs: 16
  model (V0:R1) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:R1, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0

analyze test06d :
  num-regs: 16
  num-fregs: 16
  model (V0:R1) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:R1, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    clear-registers
    assign V0
    
analyze test06e :
  num-regs: 16
  num-fregs: 16
  model (V0:R1) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:Rx, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    clear-registers
    assign V0
    
analyze test06f :
  num-regs: 16
  num-fregs: 16
  model (V0:R1) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:Rx, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0

analyze test06g :
  num-regs: 16
  num-fregs: 16
  model (V0:R3) = op11(V1:R1, V2:Rx, V3:Rx) (temp V4:Rx, V5:Rx) :
    release V1
    release V2
    release V3
    assign V4
    assign V5
    assign V0
